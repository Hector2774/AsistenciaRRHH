{% extends 'layouts/base.html' %}

{% block content %}
    <script>
        function filtrarEmpleados() {
            const sucursalId = document.getElementById('sucursal').value;
            const departamento = document.getElementById('departamento').value;

            if (sucursalId && departamento) {
                fetch(`obtener-empleados/?sucursal_id=${sucursalId}&departamento=${departamento}`)
                    .then(response => response.json())
                    .then(data => {
                        const empleadoSelect = document.getElementById('empleado');
                        empleadoSelect.innerHTML = '<option value="">Seleccione un empleado</option>';
                        data.forEach(emp => {
                            const option = document.createElement('option');
                            option.value = emp.id;
                            option.textContent = emp.nombre;
                            empleadoSelect.appendChild(option);
                        });
                    });
            }
        }
    </script>
</head>
<body>
    
    <div class="container mt-5">

      <form method="post" enctype="multipart/form-data" class="border p-4 rounded border-shadow-blue"">
        {% csrf_token %}

        <div class="d-flex align-items-center border border-dark p-3 rounded">       
          <h1>Solicitar Permiso</h1>
      </div>
      <br>
        <div class="mb-3">
          <label for="sucursal" class="fw-bold">Sucursal:</label>
          <select id="sucursal" class="form-select " name="sucursal" onchange="filtrarEmpleados()" required>
              <option value="">Seleccione una sucursal</option>
              {% for s in sucursales %}
              <option value="{{ s.id }}">{{ s.nombre }}</option>
              {% endfor %}
          </select>
        </div>
       
        <div class="mb-3">
          <label for="departamento" class="fw-bold">Departamento:</label>
          <select id="departamento" class="form-select" name="departamento" onchange="filtrarEmpleados()" required>
              <option value="">Seleccione un departamento</option>
              {% for d in departamentos %}
              <option value="{{ d }}">{{ d }}</option>
              {% endfor %}
          </select>
        </div>
       
        <div class="mb-3">
          <label for="empleado" class="fw-bold">Empleado:</label>
          <select id="empleado" name="empleado" class="form-select" required>
              <option value="">Seleccione un empleado</option>
          </select>
        </div>
       
        <div class="mb-3">
          <label for="tipo_permiso" class="fw-bold">Tipo de Permiso:</label>
          <select id="tipo_permiso" name="tipo_permiso" class="form-select" required>
            <option value="">seleccione</option>
            {% for tp in tipo_permisos %}
            <option value="{{tp.id}}">{{tp.tipo}}</option>
            {% endfor %}
        </select>
        </div>
        
        <div class="row mb-3">
          <div class="col-md-6"> 
            <label for="fecha_inicio" class="fw-bold">Fecha de inicio:</label>
            <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label for="fecha_final" class="fw-bold">Fecha final:</label>
            <input type="date" name="fecha_final" id="fecha_final" class="form-control" required>
          </div>
          
        </div>
       
       

        <div class="mb-3">
          <label for="descripcion" class="fw-bold">Descripción Motivo:</label>
          <textarea name="descripcion" id="descripcion" rows="4" class="form-control" required></textarea>
        </div>

        <div class="alert alert-warning" role="alert">
          Las solicitudes de permiso laboral se deben presentar dos días antes del primer día de ausencia, a
          excepción del permiso por enfermedad. RRHH es quien dará la aprobación final de los permisos.
      </div>

        <div class="mb-3">
          <label for="comprobante" class="fw-bold">Comprobante (archivo):</label>
        <input type="file" name="comprobante" id="comprobante" class="form-control" required>
        </div>
  
<br>
        
        <div class="text-center">
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
    </form>
<br><br>
    </div>

{% endblock %}